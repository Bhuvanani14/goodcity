<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infrastructure & Road Safety - Good City</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            color: #1e293b;
            min-height: 100%;
        }

        html {
            height: 100%;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3b82f6;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: #475569;
            text-decoration: none;
            transition: color 0.3s ease;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #3b82f6;
        }

        /* Main Content */
        main {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Header Section */
        .page-header {
            text-align: center;
            padding: 2rem 0 3rem;
            border-bottom: 1px solid rgba(34, 36, 179, 0.3);
            margin-bottom: 2rem;
        }

        .page-header h1 {
            font-size: 2.8rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-header .category-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            display: block;
        }

        .page-header p {
            font-size: 1.2rem;
            opacity: 0.8;
            color: #64748b;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 3rem;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #3b82f6;
            display: block;
        }

        .stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            color: #64748b;
        }

        /* Filter Section */
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 0.7rem 1.2rem;
            border: 1px solid rgba(226, 232, 240, 0.5);
            background: transparent;
            color: #475569;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            border-color: #3b82f6;
            color: white;
        }

        /* Issues List */
        .issues-container {
            margin-bottom: 6rem;
        }

        .issue-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #3b82f6;
            margin: 0 0 0.5rem 0;
        }

        .priority-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-low {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .priority-moderate {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .priority-urgent {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .issue-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 1rem;
            color: #64748b;
        }

        .issue-description {
            line-height: 1.6;
            margin-bottom: 1rem;
            opacity: 0.9;
            color: #475569;
        }

        .issue-location {
            background: rgba(59, 130, 246, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: inline-block;
            color: #3b82f6;
        }

        .issue-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .upvote-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
            padding: 0.7rem 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .upvote-btn:hover {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            transform: translateY(-1px);
        }

        .upvote-btn.voted {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        .vote-count {
            font-weight: bold;
            color: #3b82f6;
        }

        /* Floating Action Button */
        .fab {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            z-index: 999;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.8rem;
            color: #3b82f6;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: #64748b;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #3b82f6;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 1rem;
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            font-size: 1rem;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: rgba(100, 116, 139, 0.7);
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.2);
        }

        .file-upload {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(59, 130, 246, 0.02);
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload input {
            display: none;
        }

        .submit-btn {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .page-header h1 {
                font-size: 2rem;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
            }

            .filters {
                justify-content: center;
            }

            .issue-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .issue-actions {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .fab {
                bottom: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">üèôÔ∏è Good City</div>
            <ul class="nav-links">
                <li><a href="index.html">‚Üê Back to Home</a></li>
                <li><a href="#categories">Categories</a></li>
                <li><a href="#chat">AI Assistant</a></li>
                <li><a href="#contributors">Contributors</a></li>
                <li><a href="#about">About</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <header class="page-header">
            <span class="category-icon">üõ£Ô∏è</span>
            <h1>Infrastructure & Road Safety</h1>
            <p>Report and track road conditions, traffic issues, and infrastructure problems to help build safer streets for everyone in our community.</p>
        </header>

        <section class="stats-bar">
            <div class="stat-item">
                <span class="stat-number">47</span>
                <div class="stat-label">Total Issues</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">12</span>
                <div class="stat-label">Urgent Priority</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">23</span>
                <div class="stat-label">In Progress</div>
            </div>
            <div class="stat-item">
                <span class="stat-number">18</span>
                <div class="stat-label">Resolved</div>
            </div>
        </section>

        <section class="filters">
            <button class="filter-btn active">All Issues</button>
            <button class="filter-btn">Urgent</button>
            <button class="filter-btn">Moderate</button>
            <button class="filter-btn">Low Priority</button>
            <button class="filter-btn">Recent</button>
            <button class="filter-btn">Most Voted</button>
        </section>

        <section class="issues-container">
            <article class="issue-card">
                <div class="issue-header">
                    <div>
                        <h3 class="issue-title">Large Pothole on MG Road Intersection</h3>
                        <div class="issue-meta">
                            <span>üìÖ Reported 3 days ago</span>
                            <span>üë§ By Priya S.</span>
                        </div>
                    </div>
                    <span class="priority-badge priority-urgent">Urgent</span>
                </div>
                <p class="issue-description">
                    There's a massive pothole at the intersection of MG Road and Brigade Road that's causing damage to vehicles and creating a safety hazard. Multiple cars have already suffered tire damage, and it's particularly dangerous during monsoon when it fills with water.
                </p>
                <div class="issue-location">üìç MG Road & Brigade Road, Bangalore</div>
                <div class="issue-actions">
                    <button class="upvote-btn" onclick="toggleUpvote(this)">
                        <span>üëç</span>
                        <span>Upvote</span>
                        <span class="vote-count">(24)</span>
                    </button>
                    <span style="opacity: 0.7;">Status: Under Review</span>
                </div>
            </article>

            <article class="issue-card">
                <div class="issue-header">
                    <div>
                        <h3 class="issue-title">Broken Street Light on Elm Street</h3>
                        <div class="issue-meta">
                            <span>üìÖ Reported 1 week ago</span>
                            <span>üë§ By Mike R.</span>
                        </div>
                    </div>
                    <span class="priority-badge priority-moderate">Moderate</span>
                </div>
                <p class="issue-description">
                    The street light near house number 245 on Elm Street has been out for over two weeks. This area gets very dark at night and poses a safety risk for pedestrians and cyclists.
                </p>
                <div class="issue-location">üìç 245 Elm Street, Residential Area</div>
                <div class="issue-actions">
                    <button class="upvote-btn" onclick="toggleUpvote(this)">
                        <span>üëç</span>
                        <span>Upvote</span>
                        <span class="vote-count">(18)</span>
                    </button>
                    <span style="opacity: 0.7;">Status: Scheduled for Repair</span>
                </div>
            </article>

            <article class="issue-card">
                <div class="issue-header">
                    <div>
                        <h3 class="issue-title">Faded Road Markings on Highway 101</h3>
                        <div class="issue-meta">
                            <span>üìÖ Reported 5 days ago</span>
                            <span>üë§ By Jennifer L.</span>
                        </div>
                    </div>
                    <span class="priority-badge priority-moderate">Moderate</span>
                </div>
                <p class="issue-description">
                    The lane markings on Highway 101 between exits 15 and 17 are severely faded and barely visible, especially during rainy conditions. This creates confusion for drivers and increases accident risk.
                </p>
                <div class="issue-location">üìç Highway 101, Exits 15-17</div>
                <div class="issue-actions">
                    <button class="upvote-btn" onclick="toggleUpvote(this)">
                        <span>üëç</span>
                        <span>Upvote</span>
                        <span class="vote-count">(31)</span>
                    </button>
                    <span style="opacity: 0.7;">Status: Under Review</span>
                </div>
            </article>

            <article class="issue-card">
                <div class="issue-header">
                    <div>
                        <h3 class="issue-title">Missing Stop Sign at School Zone</h3>
                        <div class="issue-meta">
                            <span>üìÖ Reported 2 days ago</span>
                            <span>üë§ By David K.</span>
                        </div>
                    </div>
                    <span class="priority-badge priority-urgent">Urgent</span>
                </div>
                <p class="issue-description">
                    The stop sign at the intersection near Lincoln Elementary School was knocked down during last week's storm and hasn't been replaced. This is extremely dangerous during school hours with children crossing.
                </p>
                <div class="issue-location">üìç School Street & 3rd Avenue, School Zone</div>
                <div class="issue-actions">
                    <button class="upvote-btn" onclick="toggleUpvote(this)">
                        <span>üëç</span>
                        <span>Upvote</span>
                        <span class="vote-count">(42)</span>
                    </button>
                    <span style="opacity: 0.7;">Status: Emergency Priority</span>
                </div>
            </article>

            <article class="issue-card">
                <div class="issue-header">
                    <div>
                        <h3 class="issue-title">Cracked Sidewalk on Pine Avenue</h3>
                        <div class="issue-meta">
                            <span>üìÖ Reported 1 week ago</span>
                            <span>üë§ By Maria S.</span>
                        </div>
                    </div>
                    <span class="priority-badge priority-low">Low</span>
                </div>
                <p class="issue-description">
                    Several sections of the sidewalk on Pine Avenue have large cracks that could become trip hazards. While not immediately dangerous, they should be repaired before they worsen.
                </p>
                <div class="issue-location">üìç Pine Avenue, Block 400-500</div>
                <div class="issue-actions">
                    <button class="upvote-btn" onclick="toggleUpvote(this)">
                        <span>üëç</span>
                        <span>Upvote</span>
                        <span class="vote-count">(9)</span>
                    </button>
                    <span style="opacity: 0.7;">Status: Planned Maintenance</span>
                </div>
            </article>
        </section>
    </main>

    <!-- Floating Action Button -->
    <button class="fab" onclick="openModal()" title="Report New Issue">
        ‚ûï
    </button>

    <!-- Modal for New Complaint -->
    <div class="modal" id="complaintModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Report New Infrastructure Issue</h2>
                <button class="close-btn" onclick="closeModal()">‚úï</button>
            </div>
            <form id="complaintForm">
                <div class="form-group">
                    <label for="issueTitle">Issue Title *</label>
                    <input type="text" id="issueTitle" name="issueTitle" placeholder="Brief description of the issue" required>
                </div>

                <div class="form-group">
                    <label for="issueDescription">Detailed Description *</label>
                    <textarea id="issueDescription" name="issueDescription" rows="4" placeholder="Provide a detailed description of the infrastructure or road safety issue..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="issueLocation">Location *</label>
                    <input type="text" id="issueLocation" name="issueLocation" placeholder="Street address or intersection" required>
                </div>

                <div class="form-group">
                    <label for="issuePriority">Priority Level</label>
                    <select id="issuePriority" name="issuePriority">
                        <option value="low">Low - Minor issue, not immediately dangerous</option>
                        <option value="moderate">Moderate - Needs attention soon</option>
                        <option value="urgent">Urgent - Safety hazard, needs immediate attention</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="issuePhotos">Upload Photos (Optional)</label>
                    <div class="file-upload" onclick="document.getElementById('issuePhotos').click()">
                        <input type="file" id="issuePhotos" name="issuePhotos" multiple accept="image/*">
                        <div>üì∑ Click to upload photos of the issue</div>
                        <small style="opacity: 0.7;">Supports multiple images (JPG, PNG)</small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="reporterName">Your Name (Optional)</label>
                    <input type="text" id="reporterName" name="reporterName" placeholder="Your name for follow-up">
                </div>

                <div class="form-group">
                    <label for="reporterContact">Contact Information (Optional)</label>
                    <input type="email" id="reporterContact" name="reporterContact" placeholder="Email for updates on this issue">
                </div>

                <button type="submit" class="submit-btn">Submit Issue Report</button>
            </form>
        </div>
    </div>

    <script>
        const CATEGORY = 'infrastructure'; // Define the category for this page

        // Modal functionality
        function openModal() {
            document.getElementById('complaintModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('complaintModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            document.getElementById('complaintForm').reset(); // Clear form on close
            document.querySelector('.file-upload div').textContent = 'üì∑ Click to upload photos of the issue';
            document.querySelector('.file-upload small').textContent = 'Supports multiple images (JPG, PNG)';
        }

        // Close modal when clicking outside
        document.getElementById('complaintModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Upvote functionality
        async function toggleUpvote(button, issueId) {
            const userSession = JSON.parse(localStorage.getItem('userSession'));
            if (!userSession || !userSession.token) {
                alert('Please log in to upvote issues.');
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`/api/issues/${issueId}/vote`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userSession.token}`
                    }
                });

                const data = await response.json();
                if (response.ok) {
                    const voteCountSpan = button.querySelector('.vote-count');
                    voteCountSpan.textContent = `(${data.votes})`;
                    button.classList.add('voted'); // Assuming a successful vote means it's now voted
                    button.querySelector('span:nth-child(2)').textContent = 'Voted';
                } else {
                    alert(data.message || 'Failed to upvote issue.');
                }
            } catch (error) {
                console.error('Error upvoting issue:', error);
                alert('Network error. Failed to upvote issue.');
            }
        }

        // Filter functionality
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const filterType = this.textContent.trim().toLowerCase();
                let queryParams = { category: CATEGORY };

                if (filterType === 'urgent') queryParams.priority = 'urgent';
                else if (filterType === 'moderate') queryParams.priority = 'moderate';
                else if (filterType === 'low priority') queryParams.priority = 'low';
                else if (filterType === 'resolved') queryParams.status = 'resolved';
                else if (filterType === 'in progress') queryParams.status = 'in_progress';
                else if (filterType === 'pending') queryParams.status = 'pending';
                // 'All Issues' and 'Recent' (default sort) don't need specific priority/status filters

                fetchAndDisplayIssues(queryParams);
            });
        });

        // Form submission for new issue
        document.getElementById('complaintForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userSession = JSON.parse(localStorage.getItem('userSession'));
            if (!userSession || !userSession.token) {
                alert('Please log in to report issues.');
                window.location.href = 'login.html';
                return;
            }

            const formData = new FormData(this);
            const issueData = {
                title: formData.get('issueTitle'),
                description: formData.get('issueDescription'),
                location: formData.get('issueLocation'),
                priority: formData.get('issuePriority'),
                category: CATEGORY, // Set category based on the page
                images: [] // Placeholder for image URLs
            };
            
            try {
                const response = await fetch('/api/issues', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${userSession.token}`
                    },
                    body: JSON.stringify(issueData)
                });

                const data = await response.json();
                if (response.ok) {
                    alert('Thank you! Your issue has been reported successfully.');
                    closeModal();
                    fetchAndDisplayIssues({ category: CATEGORY }); // Refresh issues list
                    fetchAndDisplayStats(); // Refresh stats
                } else {
                    alert(data.message || 'Failed to report issue.');
                }
            } catch (error) {
                console.error('Error reporting issue:', error);
                alert('Network error. Failed to report issue.');
            }
        });

        // File upload preview
        document.getElementById('issuePhotos').addEventListener('change', function(e) {
            const fileUpload = document.querySelector('.file-upload');
            const files = e.target.files;
            
            if (files.length > 0) {
                fileUpload.innerHTML = `
                    <div>üì∑ ${files.length} photo(s) selected</div>
                    <small style="opacity: 0.7;">Click to change photos</small>
                `;
            }
        });

        // Smooth scrolling for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Fetch and display issues
        async function fetchAndDisplayIssues(filters = { category: CATEGORY }) {
            const issuesContainer = document.querySelector('.issues-container');
            issuesContainer.innerHTML = ''; // Clear existing issues

            const queryString = new URLSearchParams(filters).toString();

            try {
                const response = await fetch(`/api/issues?${queryString}`);
                const issues = await response.json();

                if (issues.length === 0) {
                    issuesContainer.innerHTML = '<p style="text-align: center; opacity: 0.7;">No issues found for this category and filters.</p>';
                    return;
                }

                issues.forEach(issue => {
                    const issueCard = document.createElement('article');
                    issueCard.className = 'issue-card';
                    issueCard.innerHTML = `
                        <div class="issue-header">
                            <div>
                                <h3 class="issue-title">${issue.title}</h3>
                                <div class="issue-meta">
                                    <span>üìÖ Reported ${new Date(issue.createdAt).toLocaleDateString()}</span>
                                    <span>üë§ By ${issue.reporter ? issue.reporter.username : 'Anonymous'}</span>
                                </div>
                            </div>
                            <span class="priority-badge priority-${issue.priority}">${issue.priority}</span>
                        </div>
                        <p class="issue-description">${issue.description}</p>
                        <div class="issue-location">üìç ${issue.location}</div>
                        <div class="issue-actions">
                            <button class="upvote-btn" onclick="toggleUpvote(this, '${issue._id}')">
                                <span>üëç</span>
                                <span>Upvote</span>
                                <span class="vote-count">(${issue.votes})</span>
                            </button>
                            <span style="opacity: 0.7;">Status: ${issue.status.replace('_', ' ')}</span>
                        </div>
                    `;
                    issuesContainer.appendChild(issueCard);
                });
            } catch (error) {
                console.error('Error fetching issues:', error);
                issuesContainer.innerHTML = '<p style="text-align: center; color: red;">Failed to load issues. Please try again later.</p>';
            }
        }

        // Fetch and display stats for this category
        async function fetchAndDisplayStats() {
            try {
                const userSession = JSON.parse(localStorage.getItem('userSession'));
                if (!userSession || !userSession.token) {
                    console.warn('No user session or token found for fetching stats.');
                    return;
                }

                const response = await fetch(`/api/admin/stats?category=${CATEGORY}`, {
                    headers: {
                        'Authorization': `Bearer ${userSession.token}`
                    }
                });
                const stats = await response.json();

                if (response.ok) {
                    document.querySelector('.stats-bar .stat-item:nth-child(1) .stat-number').textContent = stats.totalIssues;
                    document.querySelector('.stats-bar .stat-item:nth-child(2) .stat-number').textContent = stats.urgentIssues;
                    document.querySelector('.stats-bar .stat-item:nth-child(3) .stat-number').textContent = stats.inProgressIssues || 0; // Assuming you might add this to backend
                    document.querySelector('.stats-bar .stat-item:nth-child(4) .stat-number').textContent = stats.resolvedIssues;
                } else {
                    console.error('Failed to fetch stats:', stats.message);
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', function() {
            fetchAndDisplayIssues();
            fetchAndDisplayStats();

            // Check if user came from home page and update navigation
            if (sessionStorage.getItem('fromHomePage')) {
                sessionStorage.removeItem('fromHomePage');
                // Update nav links to include back to home
                const navLinks = document.querySelector('.nav-links');
                if (navLinks) {
                    const homeLink = navLinks.querySelector('a[href="#home"]');
                    if (homeLink) {
                        homeLink.href = 'index.html';
                        homeLink.textContent = '‚Üê Back to Home';
                    }
                }
            }

            // Check if user came from category page and update navigation
            if (sessionStorage.getItem('fromCategoryPage')) {
                sessionStorage.removeItem('fromCategoryPage');
                // Update nav links to include back to category
                const navLinks = document.querySelector('.nav-links');
                if (navLinks) {
                    const homeLink = navLinks.querySelector('a[href="#home"]');
                    if (homeLink) {
                        homeLink.href = sessionStorage.getItem('lastCategoryPage') || 'index.html';
                        homeLink.textContent = '‚Üê Back to Category';
                    }
                }
            }
        });
    </script>
</body>
</html>
