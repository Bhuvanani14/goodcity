<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Good City</title>
    <style>
        body {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            color: #1e293b;
            min-height: 100%;
        }

        html {
            height: 100%;
        }

        /* Navigation */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid rgba(226, 232, 240, 0.5);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #3b82f6;
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-links a {
            color: #475569;
            text-decoration: none;
            transition: color 0.3s ease;
            font-weight: 500;
        }

        .nav-links a:hover {
            color: #3b82f6;
        }

        /* Main Content */
        main {
            margin-top: 80px;
            padding: 2rem;
        }

        .hero {
            text-align: center;
            padding: 3rem 0;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 3rem;
            opacity: 0.8;
            color: #64748b;
        }

        /* Hero Statistics */
        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-stats .stat-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .hero-stats .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
        }

        .hero-stats .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #3b82f6;
            display: block;
            margin-bottom: 0.5rem;
        }

        .hero-stats .stat-label {
            opacity: 0.8;
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        /* Category Grid */
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto 4rem;
            padding: 0 1rem;
        }

        .category-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.6));
            border: 1px solid rgba(226, 232, 240, 0.6);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }

        .category-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .category-card h3 {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #3b82f6;
        }

        .category-card p {
            opacity: 0.7;
            line-height: 1.6;
            margin-bottom: 1.5rem;
            color: #64748b;
        }

        /* Category Statistics */
        .category-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 0.5rem 0;
        }

        .issue-count {
            font-size: 0.9rem;
            color: #64748b;
            font-weight: 500;
        }

        .priority-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority-low {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .priority-moderate {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(251, 191, 36, 0.3);
        }

        .priority-urgent {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .raise-concern-btn {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 0.95rem;
        }

        .raise-concern-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
            background: linear-gradient(45deg, #1d4ed8, #1e40af);
        }

        /* AI Chatbot Section */
        .chatbot-section {
            max-width: 1200px;
            margin: 0 auto 4rem;
            padding: 0 1rem;
        }

        .chatbot-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 20px;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        .chatbot-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(29, 78, 216, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 60%, rgba(59, 130, 246, 0.03) 0%, transparent 50%);
            pointer-events: none;
        }

        .chatbot-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }

        .chatbot-header h2 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #3b82f6;
        }

        .ai-stars {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .star {
            color: #3b82f6;
            font-size: 1.5rem;
            animation: twinkle 2s infinite alternate;
        }

        .star:nth-child(2) { animation-delay: 0.5s; }
        .star:nth-child(3) { animation-delay: 1s; }
        .star:nth-child(4) { animation-delay: 1.5s; }

        @keyframes twinkle {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.2); }
        }

        .chat-input {
            width: 100%;
            padding: 1.5rem;
            border: 2px solid rgba(226, 232, 240, 0.5);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.8);
            color: #1e293b;
            font-size: 1.1rem;
            resize: vertical;
            min-height: 120px;
            position: relative;
            z-index: 1;
        }

        .chat-input::placeholder {
            color: rgba(100, 116, 139, 0.7);
        }

        .chat-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        /* Chatbot Response Styles */
        .chatbot-response {
            margin-top: 1rem;
            animation: slideInUp 0.5s ease-out;
        }

        .response-content {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(29, 78, 216, 0.05));
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 15px;
            padding: 1rem;
        }

        .response-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .response-text {
            color: #1e293b;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Notification Styles */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 3000;
            max-width: 400px;
            animation: slideInRight 0.5s ease-out;
        }

        .notification-content {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 12px;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(10px);
        }

        .notification-success .notification-content {
            border-left: 4px solid #22c55e;
        }

        .notification-error .notification-content {
            border-left: 4px solid #ef4444;
        }

        .notification-info .notification-content {
            border-left: 4px solid #3b82f6;
        }

        .notification-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .notification-message {
            color: #1e293b;
            font-weight: 500;
            flex: 1;
        }

        .notification-close {
            background: none;
            border: none;
            color: #64748b;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background 0.2s ease;
        }

        .notification-close:hover {
            background: rgba(100, 116, 139, 0.1);
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* My Issues Section */
        .my-issues-section {
            max-width: 1200px;
            margin: 4rem auto;
            padding: 0 2rem;
        }

        .my-issues-container {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .my-issues-container h2 {
            color: #3b82f6;
            margin-bottom: 2rem;
            text-align: center;
        }

        .issues-list {
            display: grid;
            gap: 1.5rem;
        }

        .issue-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.6));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .issue-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .issue-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e293b;
            margin: 0;
        }

        .issue-status {
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-pending { background: rgba(251, 191, 36, 0.2); color: #d97706; }
        .status-in_progress { background: rgba(59, 130, 246, 0.2); color: #2563eb; }
        .status-resolved { background: rgba(34, 197, 94, 0.2); color: #16a34a; }

        .issue-details {
            margin-bottom: 1rem;
        }

        .issue-description {
            color: #64748b;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .issue-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            color: #64748b;
        }

        .issue-votes {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
            color: #3b82f6;
        }

        .no-issues {
            text-align: center;
            padding: 3rem;
            color: #64748b;
        }

        .no-issues p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        /* Contributors Section */
        .contributors {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.8));
            padding: 4rem 2rem;
            margin-top: 4rem;
            border-top: 1px solid rgba(226, 232, 240, 0.5);
        }

        .contributors h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 3rem;
            color: #3b82f6;
        }

        .contributor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .contributor-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(248, 250, 252, 0.6));
            border: 1px solid rgba(226, 232, 240, 0.5);
            border-radius: 15px;
            padding: 2rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .contributor-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }

        .contributor-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .contributor-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
        }

        .contributor-info h3 {
            margin: 0 0 0.5rem 0;
            color: #3b82f6;
        }

        .contributor-location {
            opacity: 0.7;
            font-size: 0.9rem;
            color: #64748b;
        }

        .contributor-story {
            margin: 1rem 0;
            line-height: 1.6;
            opacity: 0.8;
            color: #475569;
        }

        .contributor-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .btn-secondary {
            background: transparent;
            color: #3b82f6;
            border: 1px solid #3b82f6;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        /* User Info Styles */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #3b82f6;
            font-weight: 500;
        }

        .logout-btn {
            background: linear-gradient(45deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .categories {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .contributor-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="logo">🏙️️ Good City</div>
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#categories">Categories</a></li>
                <li><a href="#chat">AI Assistant</a></li>
                <li><a href="#contributors">Contributors</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="admin_dashboard.html" style="color: #ef4444; font-weight: 600;">Admin</a></li>
            </ul>
        </div>
    </nav>

    <main>
        <section class="hero" id="home">
            <h1>Good City</h1>
            <p>Empowering Indian citizens to create positive change in their cities through collaboration and innovation</p>
            
            <!-- Real-time Statistics -->
            <div class="hero-stats">
                <div class="stat-item">
                    <div class="stat-number" id="totalIssues">0</div>
                    <div class="stat-label">Issues Reported</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="resolvedIssues">0</div>
                    <div class="stat-label">Issues Resolved</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="activeUsers">0</div>
                    <div class="stat-label">Active Citizens</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="responseTime">0.0</div>
                    <div class="stat-label">Avg Response (Days)</div>
                </div>
            </div>
        </section>

        <section class="categories" id="categories">
            <!-- Dynamic category cards will be loaded here -->
        </section>

        <!-- My Issues Section (only visible when logged in) -->
        <section class="my-issues-section" id="my-issues" style="display: none;">
            <div class="my-issues-container">
                <h2>My Reported Issues</h2>
                <div class="issues-list" id="myIssuesList">
                    <!-- User's issues will be loaded here -->
                </div>
            </div>
        </section>

        <section class="chatbot-section" id="chat">
            <div class="chatbot-container">
                <div class="chatbot-header">
                    <h2>AI City Assistant</h2>
                    <div class="ai-stars">
                        <span class="star">⭐</span>
                        <span class="star">✨</span>
                        <span class="star">⭐</span>
                        <span class="star">✨</span>
                    </div>
                    <p>Describe your city concern and get instant guidance on how to address it</p>
                </div>
                <textarea
                    class="chat-input"
                    placeholder="Tell me about the issue you'd like to address in your city... For example: 'There's a pothole on Main Street that's been there for weeks' or 'The park near my house needs better lighting for safety'"
                    rows="4"
                ></textarea>
            </div>
        </section>
    </main>

    <section class="contributors" id="contributors">
        <h2>Community Heroes</h2>
        <div class="contributor-grid">
            <div class="contributor-card">
                <div class="contributor-header">
                    <div class="contributor-avatar">🌊</div>
                    <div class="contributor-info">
                        <h3>Vikram NGO</h3>
                        <div class="contributor-location">Based in Hyderabad</div>
                    </div>
                </div>
                <div class="contributor-story">
                    Successfully cleaned and restored the contaminated Hussain Sagar Lake, removing tons of waste and implementing sustainable maintenance practices. Their dedicated team of 50+ volunteers worked tirelessly for 8 months to transform this vital water body.
                </div>
                <div class="contributor-actions">
                    <a href="#" class="btn btn-primary">Watch Their Story</a>
                    <a href="#" class="btn btn-secondary">Support Mission</a>
                </div>
            </div>

            <div class="contributor-card">
                <div class="contributor-header">
                    <div class="contributor-avatar">🌱</div>
                    <div class="contributor-info">
                        <h3>Green Mumbai Initiative</h3>
                        <div class="contributor-location">Based in Mumbai</div>
                    </div>
                </div>
                <div class="contributor-story">
                    Planted over 10,000 trees across Mumbai's urban areas and created 15 community gardens. Their innovative vertical gardening solutions have transformed concrete spaces into green oases, improving air quality for thousands of residents.
                </div>
                <div class="contributor-actions">
                    <a href="#" class="btn btn-primary">Watch Their Story</a>
                    <a href="#" class="btn btn-secondary">Support Mission</a>
                </div>
            </div>

            <div class="contributor-card">
                <div class="contributor-header">
                    <div class="contributor-avatar">🚸</div>
                    <div class="contributor-info">
                        <h3>Safe Streets Bangalore</h3>
                        <div class="contributor-location">Based in Bangalore</div>
                    </div>
                </div>
                <div class="contributor-story">
                    Installed 200+ speed breakers and safety signs near schools, reducing traffic accidents by 60% in their target areas. They also organized road safety awareness programs reaching over 5,000 students and parents.
                </div>
                <div class="contributor-actions">
                    <a href="#" class="btn btn-primary">Watch Their Story</a>
                    <a href="#" class="btn btn-secondary">Support Mission</a>
                </div>
            </div>

            <div class="contributor-card">
                <div class="contributor-header">
                    <div class="contributor-avatar">💡</div>
                    <div class="contributor-info">
                        <h3>Delhi Solar Collective</h3>
                        <div class="contributor-location">Based in Delhi</div>
                    </div>
                </div>
                <div class="contributor-story">
                    Installed solar-powered street lights in 25 underserved neighborhoods, providing safe passage for night commuters. Their community-funded approach has become a model for sustainable urban lighting solutions.
                </div>
                <div class="contributor-actions">
                    <a href="#" class="btn btn-primary">Watch Their Story</a>
                    <a href="#" class="btn btn-secondary">Support Mission</a>
                </div>
            </div>
        </div>
    </section>

    <script>
        // Dynamic Statistics Animation
        function animateCounter(elementId, targetValue, duration = 2000) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const increment = targetValue / (duration / 16);
            let currentValue = startValue;
            
            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= targetValue) {
                    currentValue = targetValue;
                    clearInterval(timer);
                }
                
                if (elementId === 'responseTime') {
                    element.textContent = currentValue.toFixed(1);
                } else {
                    element.textContent = Math.floor(currentValue).toLocaleString();
                }
            }, 16);
        }

        // Initialize counters when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Animate statistics
            fetchAndDisplayStats();
            setInterval(fetchAndDisplayStats, 30000); // Update every 30 seconds
            fetchAndDisplayCategories();
            // Update stats when page becomes visible again
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden) {
                    fetchAndDisplayStats();
                    fetchAndDisplayCategories();
                    // Refresh My Issues if user is logged in
                    const userSession = localStorage.getItem('userSession');
                    if (userSession) {
                        const session = JSON.parse(userSession);
                        const loginTime = new Date(session.loginTime);
                        const now = new Date();
                        const hoursDiff = (now - loginTime) / (1000 * 60 * 60);
                        if (hoursDiff < 24) {
                            fetchAndDisplayMyIssues();
                        }
                    }
                }
            });

            // Check if user came from category page and update navigation
            if (sessionStorage.getItem('fromCategoryPage')) {
                sessionStorage.removeItem('fromCategoryPage');
                // Update nav links to include back to category
                const navLinks = document.querySelector('.nav-links');
                if (navLinks) {
                    const homeLink = navLinks.querySelector('a[href="#home"]');
                    if (homeLink) {
                        homeLink.href = sessionStorage.getItem('lastCategoryPage') || 'index.html';
                        homeLink.textContent = '← Back to Category';
                    }
                }
            }
        });

        async function fetchAndDisplayStats() {
            try {
                const userSession = JSON.parse(localStorage.getItem('userSession'));
                if (!userSession || !userSession.token) {
                    console.warn('No user session or token found for fetching stats.');
                    return;
                }

                const response = await fetch('/api/admin/stats', {
                    headers: {
                        'Authorization': `Bearer ${userSession.token}`
                    }
                });
                const stats = await response.json();

                if (response.ok) {
                    // Use real data from backend, with fallbacks for missing fields
                    animateCounter('totalIssues', stats.totalIssues || 0);
                    animateCounter('resolvedIssues', stats.resolvedIssues || 0);
                    animateCounter('activeUsers', stats.activeUsers || 0);
                    animateCounter('responseTime', stats.avgResponseTime || 0);
                } else {
                    console.error('Failed to fetch stats:', stats.message);
                }
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        async function fetchAndDisplayCategories() {
            const categoriesContainer = document.querySelector('.categories');
            categoriesContainer.innerHTML = ''; // Clear existing hardcoded categories

            const categoryData = [
                { id: 'infrastructure', icon: '🛣️', title: 'Infrastructure & Road Safety', description: 'Report road conditions, traffic issues, and infrastructure problems to help build safer streets for everyone.', page: 'Infra.html' },
                { id: 'sanitation', icon: '🗑️', title: 'Sanitation & Waste Management', description: 'Address cleanliness concerns, waste disposal issues, and promote sustainable waste management practices.', page: 'sanitation.html' },
                { id: 'utilities', icon: '⚡', title: 'Public Utilities', description: 'Report issues with water supply, electricity, gas, and other essential public utility services.', page: 'Public_Utilities.html' },
                { id: 'environment', icon: '🌳', title: 'Environment & Public Spaces', description: 'Protect green spaces, improve air quality, and enhance public parks and recreational areas.', page: 'environment_&_public_spaces.html' },
                { id: 'civic', icon: '🏛️', title: 'Civic Amenities & Services', description: 'Improve public facilities, government services, and community amenities for better quality of life.', page: 'Civic_Amenities_&_Services.html' },
                { id: 'safety', icon: '🚨', title: 'Safety & Law Enforcement', description: 'Report safety concerns, security issues, and work with law enforcement to create safer neighborhoods.', page: 'Safety_&_Law_Enforcement.html' }
            ];

            for (const cat of categoryData) {
                try {
                    const response = await fetch(`/api/issues?category=${cat.id}`);
                    const issues = await response.json();
                    const totalIssues = issues.length;
                    const urgentIssues = issues.filter(issue => issue.priority === 'urgent').length;

                    const categoryCard = document.createElement('div');
                    categoryCard.className = 'category-card';
                    categoryCard.dataset.category = cat.id;
                    categoryCard.innerHTML = `
                        <span class="category-icon">${cat.icon}</span>
                        <h3>${cat.title}</h3>
                        <p>${cat.description}</p>
                        <div class="category-stats">
                            <span class="issue-count">${totalIssues} issues</span>
                            <span class="priority-badge priority-urgent">${urgentIssues} urgent</span>
                        </div>
                        <button class="raise-concern-btn" data-page="${cat.page}">Raise a Concern</button>
                    `;
                    categoriesContainer.appendChild(categoryCard);
                } catch (error) {
                    console.error(`Error fetching issues for category ${cat.id}:`, error);
                    // Fallback to display card without dynamic data if fetch fails
                    const categoryCard = document.createElement('div');
                    categoryCard.className = 'category-card';
                    categoryCard.dataset.category = cat.id;
                    categoryCard.innerHTML = `
                        <span class="category-icon">${cat.icon}</span>
                        <h3>${cat.title}</h3>
                        <p>${cat.description}</p>
                        <div class="category-stats">
                            <span class="issue-count">N/A issues</span>
                            <span class="priority-badge priority-urgent">N/A urgent</span>
                        </div>
                        <button class="raise-concern-btn" data-page="${cat.page}">Raise a Concern</button>
                    `;
                    categoriesContainer.appendChild(categoryCard);
                }
            }
            // Attach event listeners for newly created category cards
            attachCategoryCardListeners();
        }

        function navigateToCategory(page) {
            // Store current page state for back navigation
            sessionStorage.setItem('fromHomePage', 'true');
            sessionStorage.setItem('lastCategoryPage', page);
            window.location.href = page;
        }

        function attachCategoryCardListeners() {
            // Category card interactions
            document.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', function(e) {
                    // Only trigger if not clicking the button
                    if (!e.target.classList.contains('raise-concern-btn')) {
                        const title = this.querySelector('h3').textContent;
                        const chatInput = document.querySelector('.chat-input');
                        chatInput.value = `I'd like to report an issue related to: ${title}. `;
                        chatInput.focus();

                        // Scroll to chat section
                        document.querySelector('#chat').scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                });
            });

            // Raise concern button interactions
            document.querySelectorAll('.raise-concern-btn').forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation(); // Prevent card click
                    const page = this.dataset.page;
                    navigateToCategory(page);
                });
            });
        }


        function showChatbotResponse(response) {
            const chatbotContainer = document.querySelector('.chatbot-container');
            const responseDiv = document.createElement('div');
            responseDiv.className = 'chatbot-response';
            responseDiv.innerHTML = `
                <div class="response-content">
                    <div class="response-avatar">🤖</div>
                    <div class="response-text">${response}</div>
                </div>
            `;
            
            chatbotContainer.appendChild(responseDiv);
            
            // Scroll to response
            responseDiv.scrollIntoView({ behavior: 'smooth' });
            
            // Remove response after 10 seconds
            setTimeout(() => {
                responseDiv.remove();
                chatInput.dataset.responded = '';
            }, 10000);
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Check if user is logged in and update navigation
        window.addEventListener('load', function() {
            const userSession = localStorage.getItem('userSession');
            if (userSession) {
                const session = JSON.parse(userSession);
                const loginTime = new Date(session.loginTime);
                const now = new Date();
                const hoursDiff = (now - loginTime) / (1000 * 60 * 60);

                // If logged in within last 24 hours, show user info
                if (hoursDiff < 24) {
                    updateNavForLoggedInUser(session);
                } else {
                    // Clear expired session
                    localStorage.removeItem('userSession');
                }
            }
        });

        function updateNavForLoggedInUser(session) {
            const navContainer = document.querySelector('.nav-container');
            const navLinks = document.querySelector('.nav-links');

            // Add user info and logout button
            const userInfo = document.createElement('div');
            userInfo.className = 'user-info';
            userInfo.innerHTML = `
                <span>Welcome, ${session.username}</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            `;

            navContainer.appendChild(userInfo);

            // Show My Issues section and load user's issues
            document.getElementById('my-issues').style.display = 'block';
            fetchAndDisplayMyIssues();
        }

        async function fetchAndDisplayMyIssues() {
            try {
                const userSession = JSON.parse(localStorage.getItem('userSession'));
                if (!userSession || !userSession.token) {
                    return;
                }

                const response = await fetch('/api/my-issues', {
                    headers: {
                        'Authorization': `Bearer ${userSession.token}`
                    }
                });

                const issues = await response.json();
                const issuesList = document.getElementById('myIssuesList');

                if (response.ok && issues.length > 0) {
                    issuesList.innerHTML = issues.map(issue => `
                        <div class="issue-card">
                            <div class="issue-header">
                                <h3 class="issue-title">${issue.title}</h3>
                                <span class="issue-status status-${issue.status}">${issue.status.replace('_', ' ')}</span>
                            </div>
                            <div class="issue-details">
                                <p class="issue-description">${issue.description}</p>
                                <div class="issue-meta">
                                    <span>Category: ${issue.category}</span>
                                    <div class="issue-votes">
                                        <span>👍</span>
                                        <span>${issue.votes} upvotes</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    issuesList.innerHTML = `
                        <div class="no-issues">
                            <p>You haven't reported any issues yet.</p>
                            <p>Start by raising a concern in one of the categories above!</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error fetching user issues:', error);
                document.getElementById('myIssuesList').innerHTML = `
                    <div class="no-issues">
                        <p>Unable to load your issues. Please try again later.</p>
                    </div>
                `;
            }
        }

        function logout() {
            localStorage.removeItem('userSession');
            window.location.reload();
        }

    </script>
</body>
</html>
